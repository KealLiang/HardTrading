# 盘中情绪分析系统设计文档

## 1. 系统概述

### 1.1 设计目标
构建一个专门的盘中情绪分析系统，通过"六联动"信号快速感知市场情绪强度，为盘中决策提供实时支持。

### 1.2 核心理念
- **情绪优先**：专注情绪面分析，忽略题材、行业等基本面因素
- **实时性**：盘中多时点采集，及时反映情绪变化
- **简洁性**：报告简洁直观，图表一目了然
- **可操作性**：提供明确的情绪强度判断和建议

## 2. 功能架构

### 2.1 时间节点设计
```
竞价阶段：09:15, 09:20, 09:25
盘中阶段：10:00, 11:00, 13:30, 14:30 (可配置)
```

### 2.2 分析维度 - "七联动"信号
1. **涨停数量**：反映做多情绪强度
2. **跌停数量**：反映恐慌情绪程度
3. **连板高度**：反映持续性和强度
4. **炸板率**：反映资金分歧程度
5. **成交量**：反映参与度和活跃度
6. **换手率**：反映资金流动性和情绪波动
7. **封板金额**：反映资金实力强度 ⭐新增

### 2.3 情绪强度等级
- **极度狂热** (80-100分)：涨停潮，连板多，成交放量，封板资金充足
- **高度活跃** (65-79分)：涨停较多，有连板，成交活跃，资金参与积极
- **温和乐观** (50-64分)：涨停适中，情绪平稳，资金流入温和
- **谨慎观望** (35-49分)：涨停较少，成交低迷，资金观望
- **恐慌情绪** (0-34分)：跌停较多，成交萎缩，资金流出

## 3. 技术实现

### 3.1 文件结构
```
alerting/
├── auction_scheduler.py          # 原定时调度器(增强)
├── mood_analyzer.py             # 新增：情绪分析器
└── mood/                        # 新增：情绪分析结果
    └── 20250916/               # 按日期分文件夹
        ├── 0915_auction_mood.md    # 竞价情绪报告
        ├── 0915_auction_mood.png   # 竞价情绪图表
        ├── 1000_intraday_mood.md   # 盘中情绪报告
        ├── 1000_intraday_mood.png  # 盘中情绪图表
        └── ...
```

### 3.2 核心模块

#### 3.2.1 MoodAnalyzer类
```python
class MoodAnalyzer:
    def __init__(self):
        # 初始化配置
        
    def analyze_auction_mood(self, time_point: str) -> dict:
        # 竞价阶段情绪分析
        
    def analyze_intraday_mood(self, time_point: str) -> dict:
        # 盘中情绪分析
        
    def calculate_mood_score(self, data: dict) -> int:
        # 计算情绪强度评分(0-100)
        
    def generate_mood_report(self, analysis: dict, report_type: str) -> str:
        # 生成情绪报告
        
    def plot_mood_chart(self, analysis: dict, report_type: str) -> str:
        # 生成情绪图表
```

#### 3.2.2 情绪评分算法
```python
def calculate_mood_score(self, data):
    score = 0
    
    # 涨停贡献 (30分)
    zt_count = data.get('涨停数量', 0)
    score += min(30, zt_count * 2)
    
    # 跌停影响 (-20分)
    dt_count = data.get('跌停数量', 0)
    score -= dt_count * 10
    
    # 连板高度 (20分)
    max_lianban = data.get('最高连板', 0)
    score += min(20, max_lianban * 5)
    
    # 炸板率影响 (-15分)
    zhaban_rate = data.get('炸板率', 0)
    score -= zhaban_rate * 15
    
    # 成交量 (10分)
    volume_ratio = data.get('成交量比', 1.0)
    score += min(10, (volume_ratio - 1) * 10)
    
    # 换手率 (5分)
    turnover = data.get('平均换手率', 0)
    score += min(5, turnover * 0.5)
    
    return max(0, min(100, score))
```

## 4. 报告设计

### 4.1 竞价情绪报告模板
```markdown
# 竞价阶段情绪分析 (09:25)

## 情绪强度：🔥🔥🔥 (78分 - 高度活跃)

### 核心指标
- 涨停：15只 | 跌停：2只 | 净涨停：13只
- 连板：最高4板，3板以上5只
- 竞价封板：8只 (强势)

### 情绪信号
- ✅ 涨停数量充足，做多情绪强烈
- ✅ 连板高度可观，持续性良好
- ⚠️ 跌停出现，需关注分化

### 操作建议
**积极参与**：情绪高涨，适合追涨强势股
```

### 4.2 盘中情绪报告模板
```markdown
# 盘中情绪分析 (10:00)

## 情绪强度：🔥🔥 (65分 - 温和乐观)

### 核心指标
- 涨停：12只 | 跌停：3只 | 炸板：5只
- 连板维持：4板股未炸，3板股1只炸板
- 成交量比：1.2倍 | 平均换手率：3.5%

### 情绪变化
- 📈 较竞价阶段：涨停-3，跌停+1
- 🔄 炸板率：31% (适中)
- 📊 成交量：温和放量

### 操作建议
**谨慎乐观**：情绪有所降温，选股要求提高
```

## 5. 图表设计

### 5.1 竞价情绪图表 (2x2布局)
1. **情绪强度仪表盘**：0-100分的仪表盘显示
2. **涨跌停对比**：涨停vs跌停数量柱状图
3. **连板分布**：各连板高度的股票数量
4. **竞价封板强度**：封单金额vs股票数量散点图

### 5.2 盘中情绪图表 (2x2布局)
1. **情绪强度仪表盘**：当前情绪评分
2. **情绪变化趋势**：从竞价到当前的情绪变化线图
3. **炸板分析**：炸板股票数量和炸板率
4. **成交量分析**：成交量比和换手率分布

## 6. 配置参数

### 6.1 时间配置
```python
AUCTION_TIMES = ["09:15", "09:20", "09:25"]
INTRADAY_TIMES = ["10:00", "11:00", "13:30", "14:30"]  # 可配置
```

### 6.2 情绪阈值配置
```python
MOOD_THRESHOLDS = {
    "极度狂热": 90,
    "高度活跃": 70,
    "温和乐观": 50,
    "谨慎观望": 30,
    "恐慌情绪": 0
}
```

## 7. 使用方式

### 7.1 启动定时任务
```bash
# 启动增强版调度器
python alerting/auction_scheduler.py start

# 手动生成情绪分析
python alerting/mood_analyzer.py --time 0925 --type auction
python alerting/mood_analyzer.py --time 1000 --type intraday
```

### 7.2 查看结果
```bash
# 查看今日情绪分析
ls alerting/mood/20250916/

# 查看最新情绪报告
cat alerting/mood/20250916/1000_intraday_mood.md
```

## 8. 预期效果

### 8.1 竞价阶段
- 快速判断开盘情绪强度
- 识别强势板块和个股
- 为开盘操作提供依据

### 8.2 盘中阶段
- 实时跟踪情绪变化
- 及时发现情绪转折点
- 动态调整操作策略

### 8.3 整体价值
- 提高盘中决策效率
- 降低情绪化操作风险
- 增强市场敏感度
