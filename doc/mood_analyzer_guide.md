# 盘中情绪分析系统 (mood_analyzer) 使用指南

## 系统概述

mood_analyzer是一个专业的A股盘中情绪分析系统，通过多维度数据分析市场情绪强度，为交易决策提供量化参考。

## 核心功能

### 1. 双阶段分析
- **竞价阶段分析** (09:15, 09:20, 09:25)：关注开盘情绪和竞价封板
- **盘中分析** (10:00, 11:00, 13:30, 14:30)：跟踪情绪变化和炸板情况

### 2. 多维度数据源
- **涨停数据**：`ak.stock_zt_pool_em()` - 涨停股票封板情况
- **跌停数据**：`ak.stock_zt_pool_dtgc_em()` - 跌停股票封单情况  
- **炸板数据**：`ak.stock_zt_pool_zbgc_em()` - 炸板股票分歧情况

### 3. 智能评分算法
基于七维情绪数据的0-100分评分体系：

| 维度 | 权重 | 说明 |
|------|------|------|
| 涨停数量 | +25分 | 每只涨停股+1.2分 |
| 跌停数量 | -15分 | 每只跌停股-6分 |
| **炸板数量** | **-15分** | **每只炸板股-3分 (新增)** |
| 连板高度 | +15分 | 最高连板+三板以上数量 |
| 炸板率 | -12分 | 涨停中的炸板比例 |
| 成交量比 | ±8分 | 相对历史成交量 |
| 换手率 | +4分 | 平均换手率活跃度 |
| 封板金额 | +8分 | 平均封板资金强度 |

## 使用方法

### 1. 手动执行分析

```bash
# 切换虚拟环境
conda activate trading

# 竞价阶段分析
python alerting/mood_analyzer.py --type auction --time 0925

# 盘中分析
python alerting/mood_analyzer.py --type intraday --time 1000
```

### 2. 定时自动执行

```bash
# 启动定时调度器
python alerting/auction_scheduler.py start

# 停止调度器
python alerting/auction_scheduler.py stop
```

### 3. 测试功能

```bash
# 运行Mock数据测试
python tests/test_mood_analyzer.py
```

## 输出内容

### 1. 分析报告 (.md文件)

```markdown
# 盘中情绪分析 (10:00)

## 情绪强度：🔥🔥🔥🔥 (78分 - 高度活跃)

### 核心指标
- 涨停：14只 | 跌停：2只 | 炸板：3只
- 连板维持：最高5板，3板以上9只
- 成交量比：2.5倍 | 平均换手率：26.0%
- 封板金额：平均12.9亿元

### 七维情绪数据
| 维度 | 数值 | 权重贡献 |
|------|------|----------|
| 🔴 涨停数量 | 14只 | +16.8分 |
| 🟢 跌停数量 | 2只 | -12.0分 |
| 💥 炸板数量 | 3只 | -9.0分 |
| 🔗 连板高度 | 最高5板 | +15.0分 |
| 💥 炸板率 | 14.3% | -1.7分 |
| 📊 成交量比 | 2.5倍 | +8.0分 |
| 🔄 换手率 | 26.0% | +4.0分 |
| 💰 封板金额 | 12.9亿元 | +8.0分 |

### 情绪变化
- 📊 炸板率：14.3% (低炸板率，封板坚决)
- 📈 成交量：放量
- 🔄 换手率：活跃

### 操作建议
**积极参与**：情绪高涨，可追涨强势股
```

### 2. 可视化图表 (.png文件)

包含四个子图：
- **情绪强度仪表盘**：直观显示情绪等级
- **涨跌停炸板对比**：三类股票数量对比
- **量价联动分析**：散点图显示个股分布
- **封板强度分析**：不同连板高度的封板情况

## 情绪等级说明

| 分数范围 | 等级 | 图标 | 操作建议 |
|----------|------|------|----------|
| 80-100分 | 极度狂热 | 🔥🔥🔥🔥🔥 | 积极参与，追涨强势股 |
| 60-79分 | 高度活跃 | 🔥🔥🔥🔥 | 谨慎乐观，选股要求提高 |
| 40-59分 | 温和乐观 | 🔥🔥🔥 | 观望为主，等待机会 |
| 20-39分 | 谨慎观望 | 🔥🔥 | 规避风险，建议减仓 |
| 0-19分 | 恐慌情绪 | 🔥 | 严格控制风险 |

## 文件结构

```
alerting/
├── mood_analyzer.py          # 主分析模块
├── auction_scheduler.py      # 定时调度器
└── mood/                     # 输出目录
    └── YYYYMMDD/            # 按日期分类
        ├── 0925_auction_mood.md    # 竞价报告
        ├── 0925_auction_mood.png   # 竞价图表
        ├── 1000_intraday_mood.md   # 盘中报告
        └── 1000_intraday_mood.png  # 盘中图表

fetch/
└── auction_fengdan_data.py   # 数据采集模块

tests/
└── test_mood_analyzer.py     # Mock数据测试
```

## 技术特性

### 1. 智能降级
- 优先使用真实akshare数据
- 依赖缺失时自动切换Mock数据
- 确保功能在任何环境下都能运行

### 2. 字段映射
- 自动处理akshare字段名变化
- 统一内部字段标准
- 提高系统稳定性

### 3. 容错设计
- 网络异常时使用历史数据
- 数据缺失时智能补全
- 异常情况下仍能生成报告

## 最新优化 (v2.0)

### ✅ 新增炸板数据分析
- 集成炸板股票数据源
- 炸板数量纳入评分体系
- 炸板率反映市场分歧程度

### ✅ 评分算法优化
- 七维评分体系更全面
- 权重分配更合理
- 总分保持0-100平衡

### ✅ 代码结构优化
- 删除重复配置项
- 统一时间点管理
- 提高代码可维护性

## 使用建议

### 1. 竞价阶段策略
- **09:15**: 观察开盘情绪，初步判断市场方向
- **09:20**: 关注竞价封板，确认强势板块
- **09:25**: 最终确认，制定当日交易策略

### 2. 盘中跟踪策略
- **10:00**: 开盘后情绪确认，调整仓位
- **11:00**: 上午情绪变化，关注炸板率
- **13:30**: 午后开盘情绪，把握下午机会
- **14:30**: 尾盘情绪，决定隔夜持仓

### 3. 风险控制
- 情绪评分<30分时严格控制仓位
- 炸板率>50%时谨慎追涨
- 跌停数量>涨停数量时规避风险

---

**支付宝到账一百万元**
