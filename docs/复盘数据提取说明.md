# ä»å¤ç›˜æ•°æ®æå–æ‰¹é‡å›æµ‹å€™é€‰è‚¡

## åŠŸèƒ½è¯´æ˜

ä» `excel/fupan_stocks.xlsx` å¤ç›˜æ•°æ®æ–‡ä»¶ä¸­æå–ç‰¹å®šç±»å‹çš„çƒ­é—¨è‚¡ï¼Œä½œä¸ºæ‰¹é‡å›æµ‹çš„å€™é€‰è‚¡ç¥¨æ± ã€‚

ç›¸æ¯”å…¨å¸‚åœº5000åªè‚¡ç¥¨ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ï¼š
- **èšç„¦çƒ­é—¨è‚¡**ï¼šåªå›æµ‹æ›¾ç»æ´»è·ƒçš„è‚¡ç¥¨
- **æé«˜æ•ˆç‡**ï¼šå¤§å¹…å‡å°‘å›æµ‹æ•°é‡
- **é’ˆå¯¹æ€§éªŒè¯**ï¼šéªŒè¯ç­–ç•¥åœ¨å¼ºåŠ¿è‚¡ä¸Šçš„è¡¨ç°

---

## å¯ç”¨çš„Sheetç±»å‹

æ ¹æ® `fupan.py` çš„å®šä¹‰ï¼Œæ”¯æŒä»¥ä¸‹sheetç±»å‹ï¼š

| Sheetåç§° | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|----------|------|---------|
| è¿æ¿æ•°æ® | è¿ç»­æ¶¨åœçš„è‚¡ç¥¨ | éªŒè¯ç­–ç•¥å¯¹è¿æ¿è‚¡çš„æŠŠæ¡èƒ½åŠ› |
| é¦–æ¿æ•°æ® | é¦–æ¬¡æ¶¨åœçš„è‚¡ç¥¨ | éªŒè¯é¦–æ¿æ‰“æ¿ç­–ç•¥ |
| ç‚¸æ¿æ•°æ® | æ¶¨åœåæ‰“å¼€çš„è‚¡ç¥¨ | éªŒè¯ç‚¸æ¿åååŒ…ç­–ç•¥ |
| ååŒ…æ•°æ® | ä½å¼€åå¤§å¹…æ‹‰å‡çš„è‚¡ç¥¨ | éªŒè¯ååŒ…ç­–ç•¥ |
| å¤§æ¶¨æ•°æ® | æ¶¨å¹…>9%çš„è‚¡ç¥¨ | éªŒè¯å¯¹å¼ºåŠ¿è‚¡çš„è¿½è¸ª |
| å¤§è·Œæ•°æ® | è·Œå¹…>9%çš„è‚¡ç¥¨ | éªŒè¯æŠ„åº•æˆ–é¿é™©èƒ½åŠ› |
| è·Œåœæ•°æ® | è·Œåœçš„è‚¡ç¥¨ | éªŒè¯æç«¯è¡Œæƒ…å¤„ç† |
| å…³æ³¨åº¦æ¦œ | çƒ­åº¦æœ€é«˜çš„è‚¡ç¥¨ | éªŒè¯çƒ­ç‚¹è‚¡ç­–ç•¥ |
| é»˜é»˜ä¸Šæ¶¨ | æ¸©å’Œä¸Šæ¶¨çš„è‚¡ç¥¨ | éªŒè¯è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥ |

---

## ä½¿ç”¨æ–¹æ³•

### æ–¹å¼1ï¼šåœ¨ main.py ä¸­è°ƒç”¨

```python
if __name__ == '__main__':
    # æ‰“å¼€æ³¨é‡Šè¿è¡Œ
    generate_fupan_candidates()
```

### æ–¹å¼2ï¼šç›´æ¥è°ƒç”¨å‡½æ•°

```python
from bin.generate_stock_list import generate_fupan_stock_list

# æå–2025å¹´1æœˆçš„è¿æ¿è‚¡
generate_fupan_stock_list(
    sheet_names=['è¿æ¿æ•°æ®'],
    start_date='20250101',
    end_date='20250131',
    output_prefix='lianban_202501'
)
```

---

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæå–è¿æ¿è‚¡ï¼ˆå•ä¸€ç±»å‹ï¼‰

```python
generate_fupan_stock_list(
    sheet_names=['è¿æ¿æ•°æ®'],
    start_date='20250101',
    end_date='20250131',
    output_prefix='lianban_202501'
)
```

è¾“å‡ºæ–‡ä»¶ï¼š
- `data/batch_backtest/lianban_202501_20250101_20250131.txt`
- `data/batch_backtest/lianban_202501_20250101_20250131.csv`

### ç¤ºä¾‹2ï¼šæå–å¤šç§ç±»å‹çƒ­é—¨è‚¡

```python
generate_fupan_stock_list(
    sheet_names=['è¿æ¿æ•°æ®', 'é¦–æ¿æ•°æ®', 'å¤§æ¶¨æ•°æ®'],
    start_date='20250101',
    end_date='20250131',
    output_prefix='hot_stocks_202501'
)
```

è¿™ä¼šæå–1æœˆä»½æ‰€æœ‰è¿æ¿ã€é¦–æ¿ã€å¤§æ¶¨çš„è‚¡ç¥¨ï¼ˆè‡ªåŠ¨å»é‡ï¼‰ã€‚

### ç¤ºä¾‹3ï¼šæå–æ‰€æœ‰ç±»å‹ï¼ˆä¸é™æ—¥æœŸï¼‰

```python
generate_fupan_stock_list(
    sheet_names=None,  # Noneè¡¨ç¤ºæ‰€æœ‰sheet
    start_date=None,   # Noneè¡¨ç¤ºä»æœ€æ—©å¼€å§‹
    end_date=None,     # Noneè¡¨ç¤ºåˆ°æœ€æ™š
    output_prefix='all_fupan_stocks'
)
```

### ç¤ºä¾‹4ï¼šæå–æœ€è¿‘çš„çƒ­é—¨è‚¡

```python
from datetime import datetime, timedelta

# æœ€è¿‘30å¤©
end_date = datetime.now().strftime('%Y%m%d')
start_date = (datetime.now() - timedelta(days=30)).strftime('%Y%m%d')

generate_fupan_stock_list(
    sheet_names=['è¿æ¿æ•°æ®', 'é¦–æ¿æ•°æ®'],
    start_date=start_date,
    end_date=end_date,
    output_prefix='recent_30days'
)
```

---

## å®Œæ•´å·¥ä½œæµç¨‹

### Step 1: æå–å€™é€‰è‚¡

```python
# åœ¨ main.py ä¸­
generate_fupan_candidates()
```

è¿è¡Œååœ¨ `data/batch_backtest/` ç”Ÿæˆè‚¡ç¥¨åˆ—è¡¨æ–‡ä»¶ã€‚

### Step 2: æ‰¹é‡å›æµ‹

ä¿®æ”¹ `batch_backtest_from_stock_list()` å‡½æ•°ï¼š

```python
def batch_backtest_from_stock_list():
    stock_list_file = 'data/batch_backtest/lianban_202501_20250101_20250131.txt'
    
    report_path = batch_backtest_from_file(
        stock_list_file=stock_list_file,
        strategy_class=BreakoutStrategyV2,
        strategy_params={'debug': False},
        startdate=datetime(2022, 1, 1),
        enddate=datetime(2025, 10, 21),
        amount=100000,
        max_workers=6
    )
```

### Step 3: æŸ¥çœ‹ç»“æœ

åœ¨ `bin/batch_backtest_results/` ç›®å½•æŸ¥çœ‹ç”Ÿæˆçš„ExcelæŠ¥å‘Šã€‚

---

## å‚æ•°è¯´æ˜

### `generate_fupan_stock_list()` å‚æ•°

| å‚æ•° | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| fupan_file | str | å¤ç›˜æ•°æ®æ–‡ä»¶è·¯å¾„ | `'excel/fupan_stocks.xlsx'` |
| sheet_names | List[str] | è¦æå–çš„sheetåˆ—è¡¨ | `None`ï¼ˆæ‰€æœ‰sheetï¼‰ |
| start_date | str | å¼€å§‹æ—¥æœŸï¼Œæ ¼å¼'YYYYMMDD' | `None`ï¼ˆæœ€æ—©ï¼‰ |
| end_date | str | ç»“æŸæ—¥æœŸï¼Œæ ¼å¼'YYYYMMDD' | `None`ï¼ˆæœ€æ™šï¼‰ |
| output_dir | str | è¾“å‡ºç›®å½• | `'data/batch_backtest'` |
| output_prefix | str | è¾“å‡ºæ–‡ä»¶åå‰ç¼€ | `'fupan_stocks'` |

---

## æµ‹è¯•éªŒè¯

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

```bash
conda activate trading

# å¿«é€Ÿæµ‹è¯•ï¼ˆæå–è¿æ¿æ•°æ®ï¼‰
python tests/test_fupan_extraction.py --test lianban

# æµ‹è¯•å¤šç§ç±»å‹
python tests/test_fupan_extraction.py --test multiple

# å®Œæ•´æµ‹è¯•
python tests/test_fupan_extraction.py --test full
```

---

## å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šéªŒè¯æ‰“æ¿ç­–ç•¥

```python
# æå–è¿æ¿è‚¡
generate_fupan_stock_list(
    sheet_names=['è¿æ¿æ•°æ®'],
    start_date='20240101',
    end_date='20241231',
    output_prefix='lianban_2024'
)

# ç”¨æ‰“æ¿ç­–ç•¥å›æµ‹
batch_backtest_from_file(
    stock_list_file='data/batch_backtest/lianban_2024_20240101_20241231.txt',
    strategy_class=BreakoutStrategy,
    max_workers=6
)
```

### åœºæ™¯2ï¼šå¯¹æ¯”ä¸åŒæ—¶æœŸçš„å¸‚åœºè¡¨ç°

```python
# æå–Q1çš„çƒ­é—¨è‚¡
generate_fupan_stock_list(
    sheet_names=['è¿æ¿æ•°æ®', 'é¦–æ¿æ•°æ®'],
    start_date='20250101',
    end_date='20250331',
    output_prefix='hot_q1'
)

# æå–Q2çš„çƒ­é—¨è‚¡
generate_fupan_stock_list(
    sheet_names=['è¿æ¿æ•°æ®', 'é¦–æ¿æ•°æ®'],
    start_date='20250401',
    end_date='20250630',
    output_prefix='hot_q2'
)

# åˆ†åˆ«å›æµ‹å¯¹æ¯”
```

### åœºæ™¯3ï¼šç­›é€‰ç‰¹å®šè¡Œæƒ…ä¸‹çš„è‚¡ç¥¨

```python
# åªæå–å¤§æ¶¨+ç‚¸æ¿è‚¡ï¼ˆæ³¢åŠ¨å¤§çš„è‚¡ç¥¨ï¼‰
generate_fupan_stock_list(
    sheet_names=['å¤§æ¶¨æ•°æ®', 'ç‚¸æ¿æ•°æ®'],
    start_date='20250101',
    output_prefix='volatile_stocks'
)
```

---

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®æ–‡ä»¶è·¯å¾„**ï¼šç¡®ä¿ `excel/fupan_stocks.xlsx` æ–‡ä»¶å­˜åœ¨ä¸”æœ‰æ•°æ®
2. **Sheetåç§°**ï¼šå¿…é¡»ä¸å¤ç›˜æ–‡ä»¶ä¸­çš„sheetåç§°å®Œå…¨ä¸€è‡´
3. **æ—¥æœŸæ ¼å¼**ï¼šä½¿ç”¨ `YYYYMMDD` æ ¼å¼ï¼Œå¦‚ `'20250101'`
4. **è‡ªåŠ¨å»é‡**ï¼šåŒä¸€åªè‚¡ç¥¨åœ¨ä¸åŒæ—¥æœŸ/ä¸åŒsheetä¸­å‡ºç°ï¼Œåªä¿ç•™ä¸€æ¬¡
5. **è‚¡ç¥¨ä»£ç éªŒè¯**ï¼šåªæå–6ä½æ•°å­—çš„æœ‰æ•ˆè‚¡ç¥¨ä»£ç 

---

## å¸¸è§é—®é¢˜

### Q1: æå–çš„è‚¡ç¥¨æ•°é‡ä¸º0ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
- æ—¥æœŸèŒƒå›´å†…æ²¡æœ‰æ•°æ®
- Sheetåç§°æ‹¼å†™é”™è¯¯
- å¤ç›˜æ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥æ—¥æœŸèŒƒå›´æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥sheetåç§°ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- ç¡®è®¤ `excel/fupan_stocks.xlsx` å­˜åœ¨

### Q2: å¦‚ä½•æŸ¥çœ‹å¯ç”¨çš„Sheetåç§°ï¼Ÿ

```python
import pandas as pd
excel_file = pd.ExcelFile('excel/fupan_stocks.xlsx')
print("å¯ç”¨çš„Sheet:", excel_file.sheet_names)
```

### Q3: æå–å‡ºçš„è‚¡ç¥¨å¤ªå¤š/å¤ªå°‘ï¼Ÿ

**è°ƒæ•´ç­–ç•¥**ï¼š
- å¤ªå¤šï¼šç¼©å°æ—¥æœŸèŒƒå›´ï¼Œå‡å°‘sheetç±»å‹
- å¤ªå°‘ï¼šæ‰©å¤§æ—¥æœŸèŒƒå›´ï¼Œå¢åŠ sheetç±»å‹

---

## ä¼˜åŠ¿å¯¹æ¯”

| å¯¹æ¯”é¡¹ | å…¨å¸‚åœºå›æµ‹ | å¤ç›˜æ•°æ®æå– |
|--------|-----------|------------|
| è‚¡ç¥¨æ•°é‡ | ~5000åª | 50-500åªï¼ˆå¯è°ƒï¼‰ |
| å›æµ‹è€—æ—¶ | 1-2å°æ—¶ | 5-15åˆ†é’Ÿ |
| é’ˆå¯¹æ€§ | ä½ | **é«˜** |
| é€‚ç”¨åœºæ™¯ | å…¨é¢éªŒè¯ | **å¿«é€ŸéªŒè¯å¼ºåŠ¿è‚¡** |

---

**æ¨èå·¥ä½œæµç¨‹**ï¼š
1. å…ˆç”¨å¤ç›˜æ•°æ®æå–çƒ­é—¨è‚¡å¿«é€ŸéªŒè¯ç­–ç•¥
2. å¦‚æœæ•ˆæœå¥½ï¼Œå†ç”¨å…¨å¸‚åœºæ•°æ®å…¨é¢éªŒè¯
3. ç»“åˆä¸¤è€…ç»“æœï¼Œä¼˜åŒ–ç­–ç•¥å‚æ•°

---

ç¥å›æµ‹é¡ºåˆ©ï¼ğŸš€ 