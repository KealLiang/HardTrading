# æ‰¹é‡å›æµ‹åŠŸèƒ½ - å®Œæ•´å®ç°è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

é’ˆå¯¹æ‚¨æå‡ºçš„3ä¸ªç—›ç‚¹ï¼Œæˆ‘å·²ç»å®ç°äº†ä¸€ä¸ª**å®Œæ•´çš„å¤§æ‰¹é‡å›æµ‹è§£å†³æ–¹æ¡ˆ**ï¼š

### âœ… ç—›ç‚¹1ï¼šæ”¯æŒä»æ–‡ä»¶è¯»å–è‚¡ç¥¨åˆ—è¡¨
- æ”¯æŒCSVå’ŒTXTä¸¤ç§æ ¼å¼
- æä¾›å·¥å…·è„šæœ¬è‡ªåŠ¨ä»æ•°æ®ç›®å½•æå–è‚¡ç¥¨åˆ—è¡¨
- å¯æŒ‰å¸‚åœºï¼ˆæ²ªå¸‚/æ·±å¸‚/åŒ—äº¤æ‰€ï¼‰æˆ–æ¿å—ï¼ˆä¸»æ¿/åˆ›ä¸šæ¿/ç§‘åˆ›æ¿ï¼‰åˆ†ç±»ç”Ÿæˆåˆ—è¡¨

### âœ… ç—›ç‚¹2ï¼šå¤§å¹…æå‡æ€§èƒ½
- **å¤šè¿›ç¨‹å¹¶è¡Œå›æµ‹**ï¼šåˆ©ç”¨å¤šæ ¸CPUåŒæ—¶å¤„ç†å¤šåªè‚¡ç¥¨
- **æ€§èƒ½æå‡5-8å€**ï¼š5000åªè‚¡ç¥¨Ã—3å¹´æ•°æ®ï¼Œä»7å°æ—¶ç¼©çŸ­åˆ°1å°æ—¶ä»¥å†…
- ç®€åŒ–è¾“å‡ºï¼Œåªä¿ç•™å…³é”®ç»Ÿè®¡æŒ‡æ ‡ï¼Œä¸ç”Ÿæˆè¯¦ç»†å›¾è¡¨å’Œæ—¥å¿—

### âœ… ç—›ç‚¹3ï¼šç‹¬ç«‹é“¾è·¯ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
- æ–°å»ºç‹¬ç«‹æ¨¡å— `bin/batch_backtester.py`
- åœ¨ `main.py` ä¸­æ·»åŠ ç‹¬ç«‹çš„å…¥å£å‡½æ•°
- åŸæœ‰çš„å•è‚¡å›æµ‹åŠŸèƒ½å®Œå…¨ä¸å—å½±å“

---

## æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ¨¡å—
- **`bin/batch_backtester.py`** - æ‰¹é‡å›æµ‹æ ¸å¿ƒæ¨¡å—
  - æ”¯æŒä»æ–‡ä»¶/åˆ—è¡¨è¯»å–è‚¡ç¥¨
  - å¤šè¿›ç¨‹å¹¶è¡Œå›æµ‹
  - ç”ŸæˆExcelæ±‡æ€»æŠ¥å‘Š
  - æ–­ç‚¹ç»­ä¼ åŠŸèƒ½

### è¾…åŠ©å·¥å…·
- **`bin/generate_stock_list.py`** - è‚¡ç¥¨åˆ—è¡¨ç”Ÿæˆå·¥å…·
  - ä»æ•°æ®ç›®å½•æå–æ‰€æœ‰è‚¡ç¥¨ä»£ç 
  - æ”¯æŒæŒ‰å¸‚åœº/æ¿å—åˆ†ç±»
  - ç”ŸæˆTXTå’ŒCSVä¸¤ç§æ ¼å¼

### ç¤ºä¾‹æ–‡ä»¶
- **`data/stock_list_example.txt`** - è‚¡ç¥¨åˆ—è¡¨ç¤ºä¾‹

### æ–‡æ¡£
- **`bin/batch_backtest_README.md`** - è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
- **`bin/QUICK_START_æ‰¹é‡å›æµ‹.md`** - å¿«é€Ÿå¼€å§‹æŒ‡å—
- **`æ‰¹é‡å›æµ‹åŠŸèƒ½è¯´æ˜.md`** - æœ¬æ–‡ä»¶

### æµ‹è¯•
- **`tests/test_batch_backtest.py`** - åŠŸèƒ½æµ‹è¯•è„šæœ¬

### ä¸»ç¨‹åºä¿®æ”¹
- **`main.py`** - æ·»åŠ äº†ä¸¤ä¸ªæ–°å…¥å£å‡½æ•°ï¼š
  - `batch_backtest_from_stock_list()` - ä»æ–‡ä»¶è¯»å–åˆ—è¡¨æ‰¹é‡å›æµ‹
  - `batch_backtest_from_codes()` - ç›´æ¥ä½¿ç”¨ä»£ç åˆ—è¡¨æ‰¹é‡å›æµ‹

---

## å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ ç”Ÿæˆè‚¡ç¥¨åˆ—è¡¨

```bash
conda activate trading
python bin/generate_stock_list.py
```

å°†åœ¨ `data/` ç›®å½•ç”Ÿæˆï¼š
- `all_astocks.txt` - å…¨éƒ¨Aè‚¡
- `main_stocks.txt` - ä¸»æ¿
- `chinext_stocks.txt` - åˆ›ä¸šæ¿
- `star_stocks.txt` - ç§‘åˆ›æ¿
- ç­‰ç­‰...

### 2ï¸âƒ£ é…ç½®å¹¶è¿è¡Œ

åœ¨ `main.py` ä¸­ï¼š

```python
if __name__ == '__main__':
    # æ³¨é‡Šæ‰å•è‚¡å›æµ‹
    # backtrade_simulate()
    
    # å¯ç”¨æ‰¹é‡å›æµ‹
    batch_backtest_from_stock_list()
```

ç„¶åè¿è¡Œï¼š

```bash
conda activate trading
python main.py
```

### 3ï¸âƒ£ æŸ¥çœ‹ç»“æœ

åœ¨ `bin/batch_backtest_results/` ç›®å½•ä¸‹æŸ¥çœ‹ç”Ÿæˆçš„ExcelæŠ¥å‘Šã€‚

---

## æ€§èƒ½å¯¹æ¯”

### åœºæ™¯ï¼šå…¨å¸‚åœºå›æµ‹ï¼ˆ5000åªè‚¡ç¥¨ï¼Œ3å¹´æ•°æ®ï¼‰

| æ–¹å¼ | è¿›ç¨‹æ•° | é¢„è®¡è€—æ—¶ | æå‡å€æ•° |
|------|--------|----------|----------|
| åŸæœ‰æ–¹å¼ï¼ˆä¸²è¡Œï¼‰ | 1 | ~7å°æ—¶ | - |
| æ–°æ–¹æ¡ˆï¼ˆå¹¶è¡Œï¼‰ | 4 | ~2å°æ—¶ | **3.5x** |
| æ–°æ–¹æ¡ˆï¼ˆå¹¶è¡Œï¼‰ | 8 | **~1.3å°æ—¶** | **5.4x** |
| æ–°æ–¹æ¡ˆï¼ˆå¹¶è¡Œï¼‰ | 16 | **~50åˆ†é’Ÿ** | **8.4x** |

---

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå›æµ‹å…¨éƒ¨Aè‚¡

```python
from datetime import datetime
from strategy.breakout_strategy_v2 import BreakoutStrategyV2
from bin.batch_backtester import batch_backtest_from_file

# å›æµ‹å…¨éƒ¨Aè‚¡
report_path = batch_backtest_from_file(
    stock_list_file='data/all_astocks.txt',
    strategy_class=BreakoutStrategyV2,
    strategy_params={'debug': False},
    startdate=datetime(2022, 1, 1),
    enddate=datetime(2025, 10, 21),
    amount=100000,
    max_workers=8  # ä½¿ç”¨8ä¸ªå¹¶è¡Œè¿›ç¨‹
)
```

### ç¤ºä¾‹2ï¼šå›æµ‹åˆ›ä¸šæ¿

```python
report_path = batch_backtest_from_file(
    stock_list_file='data/chinext_stocks.txt',
    strategy_class=BreakoutStrategyV2,
    max_workers=6
)
```

### ç¤ºä¾‹3ï¼šå›æµ‹è‡ªé€‰è‚¡

åˆ›å»º `data/my_stocks.txt`ï¼š
```
300033
300059
600610
```

ç„¶åï¼š
```python
report_path = batch_backtest_from_file(
    stock_list_file='data/my_stocks.txt',
    strategy_class=BreakoutStrategyV2
)
```

### ç¤ºä¾‹4ï¼šç›´æ¥ä½¿ç”¨ä»£ç åˆ—è¡¨

```python
from bin.batch_backtester import batch_backtest_from_list

report_path = batch_backtest_from_list(
    stock_codes=['300033', '300059', '600610'],
    strategy_class=BreakoutStrategyV2,
    max_workers=2
)
```

---

## è¾“å‡ºæŠ¥å‘Š

ExcelæŠ¥å‘ŠåŒ…å«4ä¸ªSheetï¼š

1. **å›æµ‹ç»“æœ** - æ‰€æœ‰è‚¡ç¥¨çš„å®Œæ•´æ•°æ®ï¼ˆæŒ‰æ”¶ç›Šç‡æ’åºï¼‰
   - è‚¡ç¥¨ä»£ç ã€åˆå§‹èµ„é‡‘ã€æœ€ç»ˆèµ„é‡‘
   - ç­–ç•¥æ€»æ”¶ç›Šç‡ã€å¹´åŒ–æ”¶ç›Šç‡
   - æœ€å¤§å›æ’¤ã€å¤æ™®æ¯”ç‡
   - åŸºå‡†æ”¶ç›Šç‡ã€è¶…é¢æ”¶ç›Š
   - æ€»äº¤æ˜“æ¬¡æ•°ã€ç›ˆåˆ©äº¤æ˜“æ•°ã€èƒœç‡

2. **ç»Ÿè®¡æ±‡æ€»** - æ•´ä½“ç»Ÿè®¡
   - å›æµ‹é…ç½®ä¿¡æ¯
   - æˆåŠŸ/å¤±è´¥ç»Ÿè®¡
   - å„æŒ‡æ ‡çš„å‡å€¼ã€ä¸­ä½æ•°ã€æœ€å¤§å€¼ã€æœ€å°å€¼
   - æ•´ä½“èƒœç‡

3. **TOP10ç›ˆåˆ©** - æ”¶ç›Šç‡æœ€é«˜çš„10åªè‚¡ç¥¨

4. **TOP10äºæŸ** - æ”¶ç›Šç‡æœ€ä½çš„10åªè‚¡ç¥¨

---

## é«˜çº§åŠŸèƒ½

### æ–­ç‚¹ç»­ä¼ 

å›æµ‹ä¸­æ–­åå¯ä»¥ç»§ç»­ï¼š

```python
batch_backtest_from_file(
    stock_list_file='data/all_astocks.txt',
    resume=True  # è·³è¿‡å·²å®Œæˆçš„è‚¡ç¥¨
)
```

### è‡ªå®šä¹‰å¹¶è¡Œæ•°

æ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´ï¼š

```python
batch_backtest_from_file(
    stock_list_file='data/stock_list.txt',
    max_workers=8  # æ‰‹åŠ¨æŒ‡å®š8ä¸ªå¹¶è¡Œè¿›ç¨‹
)
```

### ç­–ç•¥å¯¹æ¯”

å¯¹æ¯”ä¸åŒç­–ç•¥çš„æ•ˆæœï¼š

```python
# ç­–ç•¥A
batch_backtest_from_file(
    stock_list_file='data/all_astocks.txt',
    strategy_class=BreakoutStrategy,
    output_dir='bin/batch_backtest_results/strategy_a'
)

# ç­–ç•¥B
batch_backtest_from_file(
    stock_list_file='data/all_astocks.txt',
    strategy_class=BreakoutStrategyV2,
    output_dir='bin/batch_backtest_results/strategy_b'
)
```

---

## æµ‹è¯•éªŒè¯

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

```bash
# å¿«é€Ÿæµ‹è¯•ï¼ˆ3åªè‚¡ç¥¨ï¼Œ1-2åˆ†é’Ÿï¼‰
conda activate trading
python tests/test_batch_backtest.py --mode small

# ä¸­ç­‰æµ‹è¯•ï¼ˆ10åªè‚¡ç¥¨ï¼Œ3-5åˆ†é’Ÿï¼‰
python tests/test_batch_backtest.py --mode medium
```

---

## æŠ€æœ¯äº®ç‚¹

1. **å¤šè¿›ç¨‹å¹¶è¡Œ** - ä½¿ç”¨ `multiprocessing.Pool` å®ç°çœŸæ­£çš„å¹¶è¡Œ
2. **å…±äº«è®¡æ•°å™¨** - ä½¿ç”¨ `Manager` å®ç°è¿›ç¨‹é—´è¿›åº¦åŒæ­¥
3. **è¾“å‡ºæ•è·** - ä½¿ç”¨ `redirect_stdout` æ•è·æ¯åªè‚¡ç¥¨çš„å›æµ‹è¾“å‡º
4. **æ­£åˆ™è§£æ** - ä»è¾“å‡ºæ–‡æœ¬ä¸­ç²¾ç¡®æå–å…³é”®æŒ‡æ ‡
5. **ExcelæŠ¥å‘Š** - ä½¿ç”¨ `openpyxl` ç”Ÿæˆå¤šSheetä¸“ä¸šæŠ¥å‘Š
6. **æ–­ç‚¹ç»­ä¼ ** - ä¸´æ—¶æ–‡ä»¶æœºåˆ¶æ”¯æŒä¸­æ–­æ¢å¤

---

## æ³¨æ„äº‹é¡¹

1. **ç¡¬ä»¶è¦æ±‚**
   - CPUï¼š8æ ¸æˆ–ä»¥ä¸Šï¼ˆæ¨èï¼‰
   - å†…å­˜ï¼š16GBæˆ–ä»¥ä¸Š
   - ç¡¬ç›˜ï¼šSSDï¼ˆæ˜¾è‘—æå‡æ€§èƒ½ï¼‰

2. **æ€§èƒ½ä¼˜åŒ–å»ºè®®**
   - æ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´ `max_workers`
   - å¤§æ‰¹é‡å›æµ‹æ—¶ç¼©çŸ­æ—¶é—´èŒƒå›´
   - å¿…è¦æ—¶åˆ†æ‰¹å¤„ç†

3. **æ•°æ®å‡†å¤‡**
   - ç¡®ä¿ `data/astocks/` ç›®å½•ä¸‹æœ‰è¶³å¤Ÿçš„è‚¡ç¥¨æ•°æ®
   - è¿è¡Œå‰å¯å…ˆç”¨å°æ‰¹é‡æµ‹è¯•

4. **å…³é—­è¯¦ç»†è¾“å‡º**
   - æ‰¹é‡å›æµ‹æ—¶å¿…é¡»è®¾ç½® `debug=False`
   - è‡ªåŠ¨å…³é—­å¯è§†åŒ–å’Œäº¤äº’å›¾

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šå†…å­˜ä¸è¶³
**è§£å†³**ï¼šå‡å°‘ `max_workers` æˆ–åˆ†æ‰¹å¤„ç†

### é—®é¢˜ï¼šæŸäº›è‚¡ç¥¨å¤±è´¥
**è§£å†³**ï¼šæ£€æŸ¥æ•°æ®æ–‡ä»¶ï¼Œæˆ–ä»åˆ—è¡¨ä¸­ç§»é™¤å¤±è´¥è‚¡ç¥¨

### é—®é¢˜ï¼šé€Ÿåº¦ä»ç„¶æ…¢
**æ£€æŸ¥**ï¼š
- æ˜¯å¦ä½¿ç”¨SSDï¼Ÿ
- `max_workers` æ˜¯å¦åˆç†ï¼Ÿ
- `debug` æ˜¯å¦ä¸º `False`ï¼Ÿ
- å›æµ‹æ—¶é—´æ˜¯å¦è¿‡é•¿ï¼Ÿ

---

## æ–‡æ¡£ç´¢å¼•

- **å¿«é€Ÿå¼€å§‹**ï¼š`bin/QUICK_START_æ‰¹é‡å›æµ‹.md`
- **è¯¦ç»†æ–‡æ¡£**ï¼š`bin/batch_backtest_README.md`
- **æœ¬è¯´æ˜**ï¼š`æ‰¹é‡å›æµ‹åŠŸèƒ½è¯´æ˜.md`

---

## ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬**: v1.0
- **æ—¥æœŸ**: 2025-10-21
- **ä½œè€…**: AI Assistant
- **ç¯å¢ƒ**: Windows 11, Python 3.x, Backtrader

---

## åç»­ä¼˜åŒ–æ–¹å‘

1. æ”¯æŒåˆ†å¸ƒå¼å›æµ‹ï¼ˆè·¨æœºå™¨ï¼‰
2. å®æ—¶è¿›åº¦Webç•Œé¢
3. æ›´å¤šå¯è§†åŒ–æŠ¥å‘Šï¼ˆå›¾è¡¨ï¼‰
4. ç­–ç•¥å‚æ•°è‡ªåŠ¨ä¼˜åŒ–é›†æˆ
5. ç»“æœå¯¹æ¯”åˆ†æå·¥å…·

---

**ç¥å›æµ‹é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜æ¬¢è¿åé¦ˆã€‚** ğŸš€ 