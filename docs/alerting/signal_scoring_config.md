# 信号评分系统配置指南

> **版本**: v1.5 | **更新**: 2025-10-25

---

## 概述

信号评分系统基于多维度技术指标和市场状态，为每个买卖信号打分（0-100分）。通过调整参数可以优化策略表现，适应不同市场环境和个股特性。

**评分阈值**：
- ⭐⭐⭐**强信号**: 85+分（高概率机会）
- ⭐⭐**中信号**: 65-84分（常规机会）
- ⭐**弱信号**: <65分（谨慎操作）

---

## 评分维度（总100分）

```
总分 = 基础分40 + 技术指标(0-20) + 价格位置(0-30) + 布林带偏离(0-15) + 量能形态(0-35)
       - 趋势惩罚(0-30) + 波动率评估(-10~+10) - 横盘惩罚(0-15) - 极端行情降级(0-70%)
```

---

## 可调参数详解

### 1. 做T适用性评估参数

#### **趋势窗口和阈值**

```python
# alerting/signal_scoring.py -> SignalScorer类
TREND_WINDOW_SHORT = 30       # 短期趋势窗口（30分钟/根）
TREND_WINDOW_MID = 60         # 中期趋势窗口（60分钟/根）
TREND_STRONG_THRESHOLD = 0.06 # 强趋势阈值（6%）
TREND_MODERATE_THRESHOLD = 0.03 # 温和趋势阈值（3%）
```

**说明**：
- 短期趋势影响权重更高（反映当前动量）
- 强趋势中逆向操作风险高，会扣更多分

**调整建议**：
- **活跃股/波动大**：`TREND_STRONG_THRESHOLD = 0.08`（提高阈值，减少误伤）
- **冷门股/波动小**：`TREND_STRONG_THRESHOLD = 0.04`（降低阈值，更敏感）

---

### 2. 横盘密集信号惩罚参数

```python
CONSOLIDATION_WINDOW = 10              # 横盘检测窗口（10根K线）
CONSOLIDATION_RANGE_EXTREME = 0.01     # 极窄幅横盘（1%）
CONSOLIDATION_RANGE_NARROW = 0.015     # 窄幅横盘（1.5%）
CONSOLIDATION_RANGE_MILD = 0.025       # 轻微横盘（2.5%）
CONSOLIDATION_DIRECTION_THRESHOLD = 0.3 # 方向一致性阈值（30%）
CONSOLIDATION_PENALTY_EXTREME = 15     # 极窄幅横盘扣分
CONSOLIDATION_PENALTY_NARROW = 10      # 窄幅横盘扣分
CONSOLIDATION_PENALTY_MILD = 5         # 轻微横盘扣分
```

**说明**：
- 价格波动小且重复信号密集时，扣除额外分数
- 做T不适合横盘行情（手续费吃掉利润）

**调整建议**：
- **信号过多**：提高扣分值（`PENALTY_NARROW = 15`）
- **信号过少**：降低扣分值或放宽波动范围

---

### 3. 极端行情降级参数 ⭐**核心**

#### **对称设计**

| 参数 | 卖出（拉升） | 买入（杀跌） |
|------|------------|------------|
| **涨跌幅阈值** | 10根涨幅>3% | 10根跌幅>3% |
| **量比阈值** | 量比>3倍 | 量比>3倍 |
| **价格位置** | 位置>95% | 位置<5% |
| **降级系数** | 总分×30% | 总分×30% |

#### **参数定义**

```python
EXTREME_MOMENTUM_THRESHOLD = 0.03  # 极端涨跌幅阈值（3%，10根K线）
EXTREME_VOLUME_THRESHOLD = 3.0     # 极端量比阈值（3倍）
EXTREME_POSITION_HIGH = 0.95       # 极端拉升价格位置上限（95%）
EXTREME_POSITION_LOW = 0.05        # 极端杀跌价格位置下限（5%）
EXTREME_PENALTY_RATIO = 0.30       # 极端行情降级系数（保留30%）
```

#### **触发条件**

**卖出降级**（极端强势拉升）：
```
IF 10根涨幅 > 3% AND 量比 > 3倍 AND 价格位置 > 95%:
    总分 = 总分 × 30%
```
**含义**：主力大举推升，创新高，不应该卖

**买入降级**（极端强势杀跌）：
```
IF 10根跌幅 > 3% AND 量比 > 3倍 AND 价格位置 < 5%:
    总分 = 总分 × 30%
```
**含义**：主力砸盘/恐慌性抛售，不应该买

#### **调整建议**

**场景1：过度降级，错过拉升末期卖点**
```python
EXTREME_MOMENTUM_THRESHOLD = 0.04  # 提高到4%
EXTREME_VOLUME_THRESHOLD = 4.0     # 提高到4倍
EXTREME_POSITION_HIGH = 0.97       # 提高到97%
```
效果：只对最极端的拉升降级

**场景2：拉升中途卖出太多**
```python
EXTREME_MOMENTUM_THRESHOLD = 0.02  # 降低到2%
EXTREME_PENALTY_RATIO = 0.20       # 加强降级到20%
```
效果：更激进地过滤拉升期信号

**场景3：平衡型（推荐默认）**
```python
EXTREME_MOMENTUM_THRESHOLD = 0.03  # 3%（默认）
EXTREME_VOLUME_THRESHOLD = 3.0     # 3倍（默认）
EXTREME_PENALTY_RATIO = 0.30       # 30%（默认）
```
效果：平衡过滤极端行情和保留温和拉升/反弹

---

## 实战调优案例

### 案例1：活跃股（如301137哈焊华通）

**问题**：急速拉升时大量卖出信号

**分析**：
- 10-22 10:58-11:12: 涨5%, 量7.4x, 位置98%
- 符合"极端拉升"条件，应该降级

**调优**：
```python
EXTREME_MOMENTUM_THRESHOLD = 0.03  # 保持3%
EXTREME_VOLUME_THRESHOLD = 3.0     # 保持3倍
EXTREME_POSITION_HIGH = 0.95       # 保持95%
```
**效果**：成功过滤极端拉升信号

---

### 案例2：震荡股（如600078澄星股份）

**问题**：反弹时卖点被过滤

**分析**：
- 10-23 10:37: 涨2.84%, 量3.4x, 位置88%
- 不满足"极端拉升"，保留信号

**调优**：
```python
# 无需调整，现有参数已正确区分
```
**效果**：保留反弹逃命点

---

## 参数调整流程

### 1. 问题诊断

**信号过多**：
- 检查买卖比（理想1:1，偏差>30%需调整）
- 检查强信号占比（理想>25%）

**信号过少**：
- 检查单股日均信号数（理想3-8次）
- 检查是否过度过滤

### 2. 参数调整

**原则**：
- 一次只调1-2个参数
- 调整幅度10-20%（避免过度）
- 回测验证效果

### 3. 效果验证

**指标**：
- 买卖比：0.8-1.2为佳
- 强信号占比：>25%为佳
- 单股日均信号：3-8次为佳

---

## 常见问题

### Q1: 如何平衡"过滤假信号"和"保留真机会"？

**A**: 通过极端行情参数精细调整：
- 提高阈值（如`EXTREME_MOMENTUM_THRESHOLD = 0.04`）→ 减少过滤
- 降低阈值（如`EXTREME_MOMENTUM_THRESHOLD = 0.02`）→ 增强过滤

### Q2: 温和拉升/下跌如何处理？

**A**: 依靠其他评分维度（RSI、价格位置、趋势惩罚）综合判断，不会被极端降级影响。

### Q3: 参数是否需要动态调整？

**A**: 建议按股票类型分组（活跃股、冷门股），使用不同参数。实盘中可每月回测一次，根据表现微调。

---

**最后更新**: 2025-10-25
**维护者**: Python量化交易专家
**版本**: v1.5 