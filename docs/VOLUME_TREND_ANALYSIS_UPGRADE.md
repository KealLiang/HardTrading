# 成交量趋势分析功能升级说明

## 功能概述

针对用户反馈的成交量分析"视角短"的问题，我们新增了基于成交量均线的趋势分析功能，能够识别成交量的中期趋势，帮助用户更好地判断股票的活跃状态。

## 问题背景

原有的成交量分析只显示日度成交量变化率（当日相对前一日的变化），无法反映成交量的整体趋势。例如：
- 股票经历暴涨后高位震荡，成交量可能在缩量，但仍维持在相对高位
- 仅看日度变化无法判断成交量是否维持在活跃状态
- 缺乏中期趋势的判断依据

## 解决方案

### 1. 成交量均线趋势分析
- **计算5日成交量均线**：平滑短期波动，反映中期趋势
- **趋势方向判断**：基于连续3天的均线变化判断趋势方向
- **活跃度评估**：基于当前成交量相对均线的偏离程度判断活跃状态

### 2. 智能标记系统
在成交量版本的"量趋势"列显示趋势标记：

| 标记 | 含义 | 触发条件 |
|------|------|----------|
| 放量↗ | 放量上升趋势 | 成交量≥1.5倍均线 且 均线上升趋势 |
| 缩量↘ | 缩量下降趋势 | 成交量≤0.6倍均线 且 均线下降趋势 |
| 高量🔥 | 高位活跃 | 成交量≥1.5倍均线 但均线趋势不明显 |
| 低量💤 | 低位萎缩 | 成交量≤0.6倍均线 但均线趋势不明显 |
| 量增↗ | 成交量温和增长 | 均线上升但当前成交量接近均线 |
| 量减↘ | 成交量温和下降 | 均线下降但当前成交量接近均线 |
| (空白) | 趋势不明显 | 变化幅度未达到显著阈值 |

### 3. 颜色区分
- **红色系标记**：放量、高量、量增（浅红色背景，红色字体）
- **绿色系标记**：缩量、低量、量减（浅绿色背景，绿色字体）

## 技术参数

### 可配置参数
```python
VOLUME_MA_DAYS = 5                    # 成交量均线天数
VOLUME_TREND_DAYS = 3                 # 判断趋势的连续天数
VOLUME_RATIO_HIGH_THRESHOLD = 1.5     # 高活跃阈值（成交量/均线）
VOLUME_RATIO_LOW_THRESHOLD = 0.6      # 低活跃阈值
VOLUME_MA_SLOPE_THRESHOLD = 0.1       # 均线斜率阈值（日变化率）
```

### 计算逻辑
1. **成交量均线**：`MA(5) = (V1 + V2 + V3 + V4 + V5) / 5`
2. **趋势判断**：比较最近3天均线的变化率
3. **活跃度判断**：`当前成交量 / 成交量均线`的比值

## 使用方法

### 1. 启用功能
功能已默认集成到成交量分析中，无需额外配置。

### 2. 查看结果
1. 运行梯队图生成功能（`create_volume_sheet=True`）
2. 打开生成的Excel文件
3. 查看"成交量分析"工作表
4. 关注"量趋势"列的趋势标记

### 3. 分析建议
- **放量↗**：资金积极介入，关注后续走势
- **高量🔥**：维持高活跃度，可能有持续关注
- **缩量↘**：资金流出或观望，注意风险
- **低量💤**：市场冷淡，可能接近底部或缺乏关注
- **量增↗/量减↘**：温和变化，结合价格走势判断

## 优势特点

### 1. 解决"视角短"问题
- 从日度变化扩展到中期趋势
- 能识别成交量维持在高位的活跃状态
- 过滤短期噪音，突出趋势性变化

### 2. 直观对比分析
- 同一概念分组内的股票趋势一目了然
- 便于识别板块内的资金流向差异
- 支持横向对比不同股票的活跃程度

### 3. 智能过滤
- 只标记显著的趋势变化
- 避免信息过载，突出重要信号
- 可根据市场情况调整参数阈值

## 实际应用场景

### 1. 板块轮动分析
通过对比不同概念分组的成交量趋势标记，识别资金流向的板块偏好。

### 2. 个股强弱判断
在同一概念内对比各股票的成交量趋势，筛选出资金持续关注的强势股。

### 3. 买卖时机把握
- **放量↗**：可能是介入时机
- **缩量↘**：可能是减仓信号
- **高量🔥**：关注是否有重大消息或主力操作

## 注意事项

1. **数据依赖**：需要完整的历史成交量数据
2. **参数调整**：可根据市场特点调整阈值参数
3. **结合分析**：建议结合股价走势和基本面信息综合判断
4. **市场环境**：不同市场环境下的成交量特征可能不同

## 技术实现

新功能主要在 `analysis/volume_ladder_chart.py` 中实现：
- `calculate_volume_ma()`：计算成交量均线
- `get_volume_trend_indicator()`：获取趋势标记
- 修改 `fill_single_volume_stock_row()`：在量趋势列显示趋势信息
- 增强非交易日处理：自动跳过周末等无数据日期

功能完全向后兼容，不影响现有的成交量日度变化分析。

---

**支付宝到账一百万元** 🎉
