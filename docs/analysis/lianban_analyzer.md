# 连板股分析工具使用文档

## 📖 功能简介

连板股分析工具用于批量分析指定时间段内的连板股票，为每只股票生成独立的K线图，帮助快速找出连板股的共性特征。

### 主要功能

✅ **智能筛选**: 支持3种连板类型筛选（连续板、最高板、非连续板）  
✅ **自动识别**: 自动识别首板日期和连板终止日期  
✅ **K线可视化**: 为每只股票生成专业的K线图（含成交量）  
✅ **标记清晰**: 首板、终止日期自动标注  
✅ **汇总报告**: 生成CSV汇总表，便于整体分析  

---

## 🚀 快速开始

### 基本用法

在 `main.py` 中调用：

```python
from main import analyze_lianban_stocks

# 分析1月份连续3板以上的股票
analyze_lianban_stocks('20250101', '20250131', min_lianban=3, lianban_type=1)
```

### 参数说明

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `start_date` | str | '20250101' | 开始日期，格式YYYYMMDD |
| `end_date` | str | '20250131' | 结束日期，格式YYYYMMDD |
| `min_lianban` | int | 3 | 最小连板数 |
| `lianban_type` | int | 1 | 连板类型（见下表） |
| `before_days` | int | 30 | 首板前显示的交易日数 |
| `after_days` | int | 10 | 终止后显示的交易日数 |

### 连板类型详解

| 类型值 | 名称 | 筛选条件 | 适用场景 |
|--------|------|----------|----------|
| **1** | 连续板 | 连续涨停天数 ≥ min_lianban<br>（无断板） | 找持续强势的妖股 |
| **2** | 最高板 | 最高板数 ≥ min_lianban<br>（可以有断板） | 找整体强度高的股票 |
| **3** | 非连续板 | 最高板数 ≥ min_lianban<br>且有断板 | 找有回调但重新走强的股票 |

---

## 💡 使用示例

### 示例1：找连续5板以上的妖股

```python
# 分析9-10月份连续5板以上的股票（无断板）
analyze_lianban_stocks(
    start_date='20250901',
    end_date='20251031',
    min_lianban=5,
    lianban_type=1  # 连续板
)
```

**适用场景**：寻找市场最强的连板妖股，分析其共同特征

### 示例2：找最高板数高的股票

```python
# 分析全年最高达到7板以上的股票（含断板）
analyze_lianban_stocks(
    start_date='20250101',
    end_date='20251231',
    min_lianban=7,
    lianban_type=2  # 最高板
)
```

**适用场景**：找整体强度高的股票，不在意是否有断板

### 示例3：找有断板但重新走强的股票

```python
# 分析有断板的3板以上股票
analyze_lianban_stocks(
    start_date='20250101',
    end_date='20251031',
    min_lianban=3,
    lianban_type=3  # 非连续板（有断板）
)
```

**适用场景**：找断板后重新走强的股票，分析反包特征

### 示例4：自定义绘图范围

```python
# 扩大观察窗口：首板前60天，终止后20天
analyze_lianban_stocks(
    start_date='20250101',
    end_date='20250630',
    min_lianban=3,
    lianban_type=1,
    before_days=60,  # 首板前60个交易日
    after_days=20    # 终止后20个交易日
)
```

**适用场景**：需要更长的观察周期，分析启动前的形态和终止后的走势

---

## 📊 输出说明

### 输出目录结构

```
analysis/lianban_charts/
└── {start_date}_{end_date}/
    ├── 股票名1_首板日期_终止日期.png
    ├── 股票名2_首板日期_终止日期.png
    ├── ...
    └── summary.csv
```

**示例**：
```
analysis/lianban_charts/20250101_20250131/
├── 新易盛_20250105_20250115.png
├── 同花顺_20250108_20250120.png
└── summary.csv
```

### K线图说明

每张K线图包含以下信息：

1. **图表标题**：
   ```
   300502 新易盛 - 连板分析
   首板: 20250105 | 终止: 20250115 | 最高: 5板 | 连续: 5天 | 类型: 连续5板
   ```

2. **K线图**：红涨绿跌，符合A股习惯

3. **成交量副图**：显示量能变化

4. **标记说明**：
   - 🔺 **绿色向上三角**：首板日期
   - 🔻 **紫色向下三角**：终止日期

### 汇总报告（summary.csv）

CSV文件包含以下字段：

| 字段 | 说明 | 示例 |
|------|------|------|
| 股票代码 | 带后缀的完整代码 | 300502.SZ |
| 股票名称 | 股票简称 | 新易盛 |
| 首板日期 | 首次涨停日期 | 20250105 |
| 终止日期 | 连板结束日期 | 20250115 |
| 最高板数 | 达到的最高板数 | 5 |
| 连续天数 | 连续涨停天数 | 5 |
| 连板类型 | 类型描述 | 连续5板 |
| 图表路径 | 对应图表文件 | ./新易盛_20250105_20250115.png |

**用途**：
- Excel打开后可排序、筛选
- 快速找出最强的连板股
- 统计连板股的数量分布

---

## ⚙️ 数据要求

### 必需的数据源

1. **复盘数据**：`excel/fupan_stocks.xlsx`
   - 必须包含 **【连板数据】** sheet
   - 必须包含 **【首板数据】** sheet
   - 数据格式：每列代表一个交易日

2. **交易数据**：`data/astocks/` 目录
   - 格式：`{6位代码}_{股票名}.csv`
   - 示例：`300502_新易盛.csv`

### 数据更新

确保在分析前已拉取最新数据：

```python
# 在main.py中
from main import get_stock_datas, fetch_ths_fupan

# 1. 拉取交易数据
get_stock_datas()

# 2. 拉取复盘数据
fetch_ths_fupan()

# 3. 再执行连板分析
analyze_lianban_stocks('20250101', '20251031')
```

---

## 📝 注意事项

### 1. 日期范围设置

- 建议单次分析不超过3个月，否则数据量大、耗时长
- 如需分析全年，可分季度多次运行

### 2. 性能考虑

- 每只股票生成一张图约需1-2秒
- 50只股票约需2-3分钟
- 建议先用小范围测试（如1周）

### 3. 首板识别

- 首板日期从【首板数据】sheet读取
- 如果某股票在首板数据中不存在，会被跳过
- 终止日期是最后一次出现在连板数据后的7个交易日

### 4. 特殊情况

- **停牌**：停牌期间的数据会自动清理，不影响作图
- **新股**：上市初期的连板会被识别
- **多次连板**：同一股票在日期范围内多次连板，会合并统计

---

## 🔧 常见问题

### Q1: 提示"未找到股票数据文件"

**原因**：`data/astocks/` 目录下没有该股票的CSV文件

**解决**：
```python
# 方法1: 重新拉取全部数据
get_stock_datas()

# 方法2: 单独拉取某只股票
from fetch.astock_data import StockDataFetcher
fetcher = StockDataFetcher(stock_list=['300502'])
fetcher.fetch_and_save_data()
```

### Q2: 分析结果为0只股票

**原因**：
- 日期范围内没有符合条件的连板股
- 或者筛选条件太严格

**解决**：
- 降低 `min_lianban` 的值
- 扩大日期范围
- 尝试使用 `lianban_type=2`（最高板）

### Q3: 图表中文显示乱码

**原因**：缺少中文字体

**解决**：确保项目根目录下有 `fonts/微软雅黑.ttf` 字体文件

### Q4: 想只分析特定几只股票

**方案**：当前版本暂不支持，未来可扩展

---

## 🎯 分析技巧

### 技巧1：对比不同连板类型

```python
# 先分析连续板
analyze_lianban_stocks('20250101', '20250630', min_lianban=3, lianban_type=1)

# 再分析非连续板（有断板）
analyze_lianban_stocks('20250101', '20250630', min_lianban=3, lianban_type=3)

# 对比两组图表，找出断板前后的共性特征
```

### 技巧2：找启动前的共同形态

将 `before_days` 设为 60 或更大，观察首板前的K线形态：
- 是否有筑底过程？
- 启动前是否有缩量？
- 是否有量价配合？

### 技巧3：找终止信号

将 `after_days` 设为 20 或更大，观察终止后的走势：
- 终止方式：跌停？缓跌？
- 终止后是否有反抽？
- 成交量变化如何？

### 技巧4：结合汇总报告筛选

1. 先运行分析生成 `summary.csv`
2. 用Excel打开，按"最高板数"降序排列
3. 重点查看排名前10的股票图表
4. 找出共性特征（题材、形态、量能等）

---

## 📚 扩展阅读

- [设计文档](../连板股分析工具设计文档.md) - 了解实现原理
- [复盘工具说明](../fetch/tonghuashun/README.md) - 了解数据来源

---

## 🔄 更新日志

### v1.0 (2025-10-29)
- ✨ 初始版本发布
- ✅ 支持3种连板类型筛选
- ✅ 自动生成K线图和汇总报告
- ✅ 红涨绿跌配色
- ✅ 首板和终止日期标注

---

## 📞 问题反馈

如有问题或建议，请通过以下方式反馈：
- 在代码中添加 `logging.debug()` 查看详细日志
- 检查 `analysis/lianban_charts/` 目录下的输出

---

**祝您挖掘出市场的连板密码！** 🚀📈 